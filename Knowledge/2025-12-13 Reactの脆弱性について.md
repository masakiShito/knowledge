---
title: "【深掘り】React Server Components（RSC）/ Flight protocol と 2025年12月の重大脆弱性（React2Shell, CVE-2025-55182）"
tags:
  - React
  - Security
  - RSC
  - Next.js
  - Vulnerability
created: 2025-12-13
---

# 0. このノートの目的（読むと何がわかる？）

2025年12月に公開・悪用が観測された **React Server Components（RSC）関連の重大脆弱性**（通称 React2Shell / **CVE-2025-55182**）を理解するために、次を **1本のナレッジ**としてまとめる。

- RSC（React Server Components）が何か（なぜ生まれ、何が違うか）
- RSCが依存する **Flight protocol** が何をしているか
- 今回の脆弱性がなぜ **「認証不要RCE」** になり得るのか（概念レベルで）
- 影響範囲（React/Next.js/周辺）と、運用での対策・検知ポイント

> ※このノートは「防御・理解」を目的とし、悪用を直接助ける具体的な手順やペイロード、再現コードは書かない。  
> ただし、設計・運用上の論点は深く書く。

---

# 1. まず結論：2025年12月の何がヤバかったのか

Reactチームは **React Server Components に “認証不要のRCE（Remote Code Execution）” がある**と公表し、緊急アップデートを推奨した。これは **Flight protocol のデコード処理（payload復元）周り**が焦点になっている。:contentReference[oaicite:0]{index=0}

日本国内でも公的機関（IPA/JVN/JPCERT/CC）が注意喚起し、国内で悪用が発生している可能性や PoC 公開・悪用試行の観測が言及された。:contentReference[oaicite:1]{index=1}

加えて、脅威インテリジェンス各社が「公開直後から複数の攻撃者に悪用されている」状況を報告している。:contentReference[oaicite:2]{index=2}

---

# 2. RSC（React Server Components）とは何か

## 2.1 一言で言うと

**「Reactのコンポーネントをサーバー側で実行し、クライアントには“描画に必要な情報”だけをストリーミングする仕組み」**。

React公式の説明でも、Server Components は “クライアントアプリやSSRサーバとは別環境の ‘server’ でレンダリングされ得る” という位置づけになっている。:contentReference[oaicite:3]{index=3}

## 2.2 従来のCSR/SSRとの違い（攻撃面の観点）

従来の代表構成はこう：

- **CSR（SPA）**：ブラウザでJSが動き、API（JSON）を叩いて描画
- **SSR**：サーバでHTMLを生成して返す（HydrationでJSが生きる）
- **RSC**：サーバで“コンポーネント”を実行し、結果を **Flight** で返す（HTML/JSONではない）

| 観点 | CSR | SSR | RSC |
|---|---|---|---|
| 主な返却物 | JSON/HTML/JS | HTML + JS | **Flight payload（独自）** |
| サーバ実行ロジック | API層に集中 | SSR層に集中 | **UI層（コンポーネント）がサーバで実行** |
| “入力→実行”距離 | API設計次第 | テンプレ中心 | **payload decode → 内部表現復元 → 実行に近い** |
| セキュリティの難所 | API認可/入力検証 | XSS/テンプレ注入 | **複雑なデシリアライズ/プロトコル実装** |

RSCは便利な一方、**“UI層がサーバで動く”** ので、サーバ側の攻撃面が増える。これは「フロントの脆弱性＝XSSが中心」という直感を壊す。

---

# 3. Flight protocol とは何か

## 3.1 一言で言うと

**RSCの実行結果（コンポーネントツリー）をクライアントに送るための通信プロトコル**。RSCが成立する土台。

OffSecの解説でも「RSCは Flight と呼ばれるプロトコルで通信する」と整理されている。:contentReference[oaicite:4]{index=4}  
WizやPalo Alto Unit42なども、今回の脆弱性は **“RSCのFlightプロトコル実装”** に紐づくと説明している。:contentReference[oaicite:5]{index=5}

## 3.2 何を運ぶ？（概念）

Flightが運ぶのは「HTML」でも「単純なJSON」でもなく、ざっくり言うと：

- サーバ側で実行されたコンポーネントツリーの“結果”
- props や参照関係
- ストリーミングのための断片
-（場合により）次に必要なチャンク情報

ここで重要なのは、**受信側（サーバ/クライアント）が payload を “decode / deserialize” して内部表現に戻す**という点。  
そしてこの **デシリアライズが複雑**になりやすいことが、セキュリティ上のボトルネックになる。

---

# 4. RSCの通信フロー（ざっくり全体像）

ここでは “概念としての流れ” を押さえる。フレームワーク（例：Next.js）で実装は異なるが、基本構造は共通。

## 4.1 RSCレンダリングフロー（イメージ）

```mermaid
sequenceDiagram
  autonumber
  participant B as Browser
  participant S as RSC Server (Node)
  participant D as DB/Secret/FS

  B->>S: Request (RSC/Flight)
  Note over S: Flight payload decode / parse
  S->>D: Execute Server Components<br/>read DB/secret/files
  D-->>S: data
  S-->>B: Response (Flight payload stream)
  Note over B: Client decodes payload<br/>renders UI
